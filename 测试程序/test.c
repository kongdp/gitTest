#include <stdio.h>

typedef unsigned char uchar;

const uchar 	HEX[16]  =   {"0123456789ABCDEF"};

//=====================================================================
//======                                                         ======
//======        原型：uchar asciiToHex(uchar)                  	 ======
//======                                                         ======
//======        功能：ascii转换成HEX                             ======
//======                                                         ======
//=====================================================================
uchar   asciiToHex(uchar c)
{
    if((c>='0')&&(c<='9'))
    {
        return c-'0';
    }
    
    if((c>='A')&&(c<='F'))
    {
        return c-'A' + 0x0A;//
    }
    
    if((c>='a')&&(c<='f')) 
    {
        return c-'a' + 0x0A;//
    }
    return 0;
}

//=====================================================================
//======                                                         ======
//======        原型：uchar  hexToAscii(uchar)                   ======
//======                                                         ======
//======        功能：hex转换成Ascii                             ======
//======                                                         ======
//=====================================================================
uchar   hexToAscii(uchar c) 
{ 
    return HEX[c];
}

/* 正常状态 */
char buf1[] = "<700894308D*#20#*700894,190118105630;1,1,0;2,3,2;4,3,0;6,5,(1 -4 515);8,2,2699;10,2,3159;11,2,3843;12,2,3719;13,3,0;14,3,0;9,2,3409;7,2,18;E>";

/* 震动告警 */
char buf2[] = "<700894308D*#20#*700894,190118105630;1,1,0;2,3,2;4,3,2;6,5,(1 -4 515);8,2,2699;10,2,3159;11,2,3843;12,2,3719;13,3,0;14,3,0;9,2,3409;7,2,18;0>";

char buf3[]= "<500296308F*#20#*500296,190128082613;1,1,3;2,3,1;4,3,0;6,5,(10 32 -365);8,2,2891;10,2,3176;11,2,3866;12,2,1681;13,3,0;14,3,0;9,2,3727;7,2,31;8>";

int main(void)
{
    unsigned char cid, prolen, i;
    unsigned short int crcCal = 0, crc = 0;

    printf("%6.4d\n",312);

    char *s = buf3;
    
    cid     = asciiToHex(s[7])*16 + asciiToHex(s[8]);
    
    prolen  = asciiToHex(s[9])*16 + asciiToHex(s[10]);
    
    crc     = s[prolen-2];
    
    for(i=1; i<(prolen-2); i++)
    {
        crcCal += s[i];
    }
    
    crcCal = crcCal%(0x10);
    
    crcCal = hexToAscii(crcCal);
    
    //----------------------------------------------------------------
    //-----  对比校验值
    if(crc != crcCal) return 1;    
}
